# ユーザー管理API仕様書

## 1. 概要

### 1.1 目的

本仕様書は、コーディングエージェントのユーザー設定を管理するためのREST APIを定義します。

### 1.2 ベースURL

デフォルト: http://localhost:8080/api/v1

---

## 2. 認証

### 2.1 APIキー認証

すべてのAPIリクエストにはAPIキーが必要です。

**ヘッダー形式:**
- X-API-Key: {api_key}

### 2.2 エラーレスポンス

認証エラー時のレスポンス：

- **ステータスコード**: 401 Unauthorized
- **レスポンス**: エラーメッセージを含むJSONオブジェクト

---

## 3. エンドポイント

### 3.1 ユーザー設定取得

**エンドポイント:** GET /config/{username}

**説明:** 指定されたユーザーの設定を取得します。

**パスパラメータ:**
- username: ユーザー名

**成功レスポンス:**
- ステータスコード: 200 OK
- レスポンス: ユーザー設定を含むJSONオブジェクト

**レスポンスフィールド:**
- llm_provider: LLMプロバイダー（openai/ollama/lmstudio）
- openai_api_key: OpenAI APIキー（復号化済み）
- openai_model: OpenAIモデル
- ollama_endpoint: Ollamaエンドポイント
- ollama_model: Ollamaモデル
- lmstudio_base_url: LM StudioベースURL
- lmstudio_model: LM Studioモデル

**エラーレスポンス:**
- 404 Not Found: ユーザーが存在しない場合

### 3.2 ヘルスチェック

**エンドポイント:** GET /health

**説明:** サーバーの状態を確認します。

**成功レスポンス:**
- ステータスコード: 200 OK
- レスポンス: 状態情報を含むJSONオブジェクト

**レスポンスフィールド:**
- status: サーバー状態（healthy）
- database: データベース接続状態（connected/disconnected）
- version: APIバージョン

---

## 4. エラーコード

| コード | 説明 |
|--------|------|
| 200 | 成功 |
| 400 | リクエストエラー |
| 401 | 認証エラー |
| 404 | リソースが見つからない |
| 500 | サーバーエラー |

---

## 5. 使用例

### 5.1 設定取得リクエスト

コーディングエージェントがユーザー設定を取得する際の典型的なフロー：

1. タスクからユーザー名を取得
2. APIキーをヘッダーに設定
3. GET /config/{username}を呼び出し
4. レスポンスから設定を取得
5. LLMクライアントを初期化

### 5.2 フォールバック処理

API呼び出しが失敗した場合：

1. エラーをログに記録
2. config.yamlのデフォルト設定を使用
3. 処理を継続

---

## 6. 関連ドキュメント

- [ユーザー設定Web仕様](USER_CONFIG_WEB_SPECIFICATION.md)

---

**文書バージョン:** 2.0  
**最終更新日:** 2024-11-28  
**ステータス:** 実装済み
